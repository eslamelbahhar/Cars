<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dubizzle Cars . Payment Guide</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg-page: #f4f5f7;
      --bg-surface: #ffffff;
      --bg-active: #e0f2fe;
      --border-subtle: #e5e7eb;
      --text-main: #111827;
      --text-muted: #6b7280;
      --accent: #2563eb;
      --radius-card: 16px;
      --shadow-card: 0 8px 16px rgba(15, 23, 42, 0.08);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg-page);
      color: var(--text-main);
      line-height: 1.5;
    }

    .page {
      max-width: 1060px;
      margin: 0 auto;
      padding: 16px 14px 28px;
    }

    header {
      margin-bottom: 12px;
    }

    h1 {
      margin: 0 0 6px;
      font-size: clamp(1.5rem, 3vw, 1.9rem);
      font-weight: 700;
      color: var(--text-main);
    }

    .subtitle {
      font-size: 0.9rem;
      color: var(--text-muted);
      max-width: 720px;
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 260px) minmax(0, 1fr);
      gap: 12px;
      margin-top: 14px;
    }

    @media (max-width: 768px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    /* Left column . scenario selector */

    .sidebar {
      background: var(--bg-surface);
      border-radius: var(--radius-card);
      box-shadow: var(--shadow-card);
      padding: 10px;
    }

    .sidebar-title {
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 8px;
    }

    .chip {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: #eef2ff;
      color: #4338ca;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    .filter-row {
      margin-bottom: 8px;
    }

    .filter-row label {
      display: block;
      font-size: 0.78rem;
      color: var(--text-muted);
      margin-bottom: 3px;
    }

    select {
      width: 100%;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid var(--border-subtle);
      font-size: 0.86rem;
      background: #f9fafb;
    }

    select:focus {
      outline: 2px solid var(--accent);
      outline-offset: 1px;
    }

    .scenario-list {
      list-style: none;
      padding: 0;
      margin: 6px 0 0;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .scenario-button {
      width: 100%;
      border: 1px solid var(--border-subtle);
      border-radius: 10px;
      padding: 7px 8px;
      background: #f9fafb;
      cursor: pointer;
      text-align: left;
      font-size: 0.85rem;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .scenario-button:hover {
      background: #f3f4ff;
    }

    .scenario-button:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 1px;
    }

    .scenario-button[aria-pressed="true"] {
      background: var(--bg-active);
      border-color: var(--accent);
    }

    .scenario-name {
      font-weight: 600;
    }

    .scenario-meta {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    /* Right column . scenario content */

    .content {
      background: var(--bg-surface);
      border-radius: var(--radius-card);
      box-shadow: var(--shadow-card);
      padding: 12px 12px 14px;
      min-height: 260px;
    }

    .content-header {
      border-bottom: 1px solid var(--border-subtle);
      padding-bottom: 8px;
      margin-bottom: 8px;
    }

    .content-tagline {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .content-title {
      font-size: 1rem;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .content-subtitle {
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .content-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
      margin-bottom: 10px;
      margin-top: 10px;
    }

    @media (max-width: 800px) {
      .content-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .info-card {
      border-radius: 10px;
      border: 1px solid var(--border-subtle);
      padding: 7px 9px;
      font-size: 0.8rem;
    }

    .info-title {
      font-size: 0.78rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      margin-bottom: 3px;
    }

    .info-body {
      font-size: 0.8rem;
      color: var(--text-main);
    }

    .pill-inline {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 999px;
      background: #e5f3ff;
      font-size: 0.72rem;
      margin: 1px 2px 1px 0;
    }

    .pill-warning {
      background: #fef3c7;
    }

    /* Stepper */

    .stepper-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 4px;
      margin-top: 4px;
    }

    .stepper-title {
      font-size: 0.86rem;
      font-weight: 600;
    }

    .stepper-buttons {
      display: flex;
      gap: 4px;
    }

    .stepper-btn {
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: #f9fafb;
      font-size: 0.78rem;
      padding: 3px 8px;
      cursor: pointer;
    }

    .stepper-btn:hover {
      background: #eef2ff;
    }

    .stepper-btn:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 1px;
    }

    .steps {
      border-radius: 10px;
      border: 1px solid var(--border-subtle);
      padding: 7px 9px;
      max-height: 220px;
      overflow-y: auto;
      background: #f9fafb;
    }

    .step {
      padding: 5px 6px;
      border-radius: 8px;
      margin-bottom: 4px;
      font-size: 0.8rem;
      cursor: pointer;
    }

    .step:hover {
      background: #e5f0ff;
    }

    .step.active {
      background: var(--bg-active);
      border-left: 3px solid var(--accent);
    }

    .step-title {
      font-weight: 600;
    }

    .step-meta {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .step-note {
      font-size: 0.75rem;
      color: var(--text-main);
      margin-top: 2px;
    }

    /* Footer */

    .footer-note {
      margin-top: 10px;
      font-size: 0.78rem;
      color: var(--text-muted);
      border-top: 1px solid var(--border-subtle);
      padding-top: 6px;
    }
  </style>
</head>
<body>
<div class="page">
  <header>
    <h1>Dubizzle Cars . Payment Process Guide</h1>
    <p class="subtitle">
      Pick the scenario. See who does what, when, and which documents are required before payment is released.
      This is a quick reference for daily operations and onboarding.
    </p>
  </header>

  <div class="layout">
    <!-- LEFT . SCENARIO SELECTOR -->
    <aside class="sidebar" aria-label="Scenarios">
      <div class="sidebar-title">1 . Choose a scenario</div>

      <div class="chip-row" aria-hidden="true">
        <span class="chip">Managed</span>
        <span class="chip">Auction</span>
        <span class="chip">POA</span>
        <span class="chip">Company</span>
      </div>

      <div class="filter-row">
        <label for="dealFilter">Deal type</label>
        <select id="dealFilter">
          <option value="all">All deals</option>
          <option value="managed">Managed only</option>
          <option value="auction">Auction only</option>
        </select>
      </div>

      <ul class="scenario-list" id="scenarioList">
        <!-- Buttons are generated by JS -->
      </ul>
    </aside>

    <!-- RIGHT . CONTENT -->
    <section class="content" aria-live="polite" aria-atomic="true">
      <div class="content-header">
        <div class="content-tagline" id="scenarioTagline">Select a scenario to begin</div>
        <div class="content-title" id="scenarioTitle">No scenario selected</div>
        <div class="content-subtitle" id="scenarioSubtitle">
          Use the list on the left to pick a managed or auction payment flow.
        </div>
      </div>

      <div class="content-grid" aria-label="Key information">
        <div class="info-card">
          <div class="info-title">People involved</div>
          <div class="info-body" id="peopleBox">
            CSR, FSR, Transfer Agent, BO Team, Finance, Auction TL.  
            This area will update when you choose a scenario.
          </div>
        </div>
        <div class="info-card">
          <div class="info-title">Timing</div>
          <div class="info-body" id="timingBox">
            Before listing, before transfer, after transfer.  
            Use this to check where you are in the flow.
          </div>
        </div>
        <div class="info-card">
          <div class="info-title">Payment can be released when</div>
          <div class="info-body" id="paymentBox">
            This box will clearly state the condition for releasing payment to the seller.
          </div>
        </div>
      </div>

      <div class="stepper-header">
        <div class="stepper-title">Step by step checklist</div>
        <div class="stepper-buttons">
          <button class="stepper-btn" type="button" id="prevStepBtn">Previous step</button>
          <button class="stepper-btn" type="button" id="nextStepBtn">Next step</button>
        </div>
      </div>

      <div class="steps" id="stepsContainer" aria-label="Checklist steps">
        <!-- Steps are injected here -->
        <div class="step">
          <div class="step-title">No steps to display</div>
          <div class="step-meta">Choose a scenario to see its checklist.</div>
        </div>
      </div>

      <div class="footer-note" id="footerNote">
        For payment status questions, refer to CRM and seller email first.  
        If payment is verified and not received after 24 hours, escalate to Finance.
      </div>
    </section>
  </div>
</div>

<script>
  const flows = [
    {
      id: "managed-ind-ind",
      dealType: "managed",
      label: "Managed . Individual seller to individual buyer",
      shortMeta: "Standard managed deal, no POA.",
      tagline: "Managed deal",
      title: "Seller individual . buyer individual",
      subtitle: "Standard managed deal for individual to individual transfer with no POA.",
      people: [
        "CSR or Purchaser at check in",
        "FSR after buyer deposit and payment",
        "Transfer Agent at RTA",
        "BO Team in CRM",
        "Finance for payment verification"
      ],
      timing: [
        "Before listing . SAA is signed by the seller, details match Mulkiya.",
        "Before transfer . FSR has full buyer payment and documents.",
        "After transfer . Transfer Agent shares buyer Mulkiya and CRM is updated."
      ],
      paymentCondition:
        "Transfer Agent confirms transfer is completed, CRM is updated with correct seller and buyer details, and Finance has verified full buyer payment.",
      steps: [
        {
          title: "Collect seller Emirates ID and Mulkiya",
          meta: "Done at check in by CSR or Purchaser.",
          note: "Names should match exactly across Emirates ID and registration card."
        },
        {
          title: "Generate and sign SAA",
          meta: "Prepared before listing by Purchaser or call center.",
          note: "Seller name and signature must match Mulkiya."
        },
        {
          title: "Collect buyer deposit and full payment",
          meta: "Handled by FSR.",
          note: "Finance must confirm that full payment has been received before transfer."
        },
        {
          title: "Sign BAA with buyer",
          meta: "Issued by FSR after deposit.",
          note: "Buyer name must match the new Mulkiya."
        },
        {
          title: "Prepare Transfer Agreement",
          meta: "Transfer Agent before RTA visit.",
          note: "If beneficiary is different from seller, collect Emirates ID or trade license for that account."
        },
        {
          title: "Complete transfer and update Mulkiya or Hayaza",
          meta: "Transfer Agent at RTA.",
          note: "Buyer Mulkiya or possession certificate is saved and shared with BO Team."
        },
        {
          title: "Update CRM and request payment",
          meta: "BO Team and Transfer Agent.",
          note: "Mark sold, confirm seller and buyer names, selling price, and fees. Only then request seller payment."
        }
      ],
      footer:
        "FSR checks steps 1 to 4 before booking the transfer. Transfer Agent checks steps 5 to 7 before asking Finance to release payment."
    },
    {
      id: "managed-poa",
      dealType: "managed",
      label: "Managed . Individual seller with POA",
      shortMeta: "Individual seller represented by POA.",
      tagline: "Managed deal",
      title: "Seller individual with POA . buyer individual",
      subtitle: "Seller is an individual, transaction handled through a power of attorney.",
      people: [
        "CSR or Purchaser at check in",
        "Transfer Agent validating POA and representative ID",
        "FSR for buyer payment and BAA",
        "BO Team and Finance"
      ],
      timing: [
        "At check in . Seller ID and Mulkiya collected.",
        "At transfer . POA and representative ID checked by Transfer Agent.",
        "After transfer . Buyer Mulkiya and CRM updated."
      ],
      paymentCondition:
        "POA is valid, representative ID matches POA, transfer is complete, CRM updated correctly, and Finance has verified full buyer payment.",
      steps: [
        {
          title: "Collect seller Emirates ID and Mulkiya",
          meta: "CSR or Purchaser at check in.",
          note: "These still belong to the named seller, even if a representative will sign later."
        },
        {
          title: "Check and collect POA",
          meta: "Transfer Agent at transfer stage.",
          note: "POA must clearly authorize the representative to sell the vehicle."
        },
        {
          title: "Collect representative Emirates ID",
          meta: "Transfer Agent at transfer stage.",
          note: "Name must match the POA document."
        },
        {
          title: "Generate and sign SAA",
          meta: "Purchaser or call center before listing.",
          note: "Signed by seller or POA holder with details matching Mulkiya or POA."
        },
        {
          title: "Collect buyer payment and issue BAA",
          meta: "FSR after deposit.",
          note: "Buyer name must match the new Mulkiya or possession certificate."
        },
        {
          title: "Prepare Transfer Agreement and complete transfer",
          meta: "Transfer Agent at RTA.",
          note: "Agreement is signed by the seller or POA holder. Beneficiary account must match supporting documents."
        },
        {
          title: "Update CRM and request payment",
          meta: "BO Team and Transfer Agent.",
          note: "Confirm seller and buyer names, prices, and fees are correct, then request payment release."
        }
      ],
      footer:
        "FSR checks documents and payments before transfer booking. Transfer Agent confirms POA and CRM details are correct before payment request."
    },
    {
      id: "auction-ind",
      dealType: "auction",
      label: "Auction . Individual seller, dealer or company buyer",
      shortMeta: "Standard auction deal, individual seller.",
      tagline: "Auction deal",
      title: "Seller individual . buyer dealer or company",
      subtitle: "Car sold via auction from an individual seller to a dealer or company buyer.",
      people: [
        "Purchaser and auction stakeholders for email approval",
        "CSR at check in",
        "DRE collecting payment from dealer",
        "Transfer Agent at RTA",
        "Auction TL and BO Team in CRM",
        "Finance to verify dealer payment"
      ],
      timing: [
        "Before auction . Email confirmation and approvals in place.",
        "After deal finalisation . VSA signed, dealer payment collected.",
        "After transfer . Buyer Mulkiya and CRM updated."
      ],
      paymentCondition:
        "Auction email approval is available, VSA is signed, dealer payment is fully received, transfer is complete, and CRM is fully updated with VAT, fees, and highest bid details.",
      steps: [
        {
          title: "Get auction email approval",
          meta: "Purchaser starts email chain with auction stakeholders.",
          note: "If car is below criteria, higher level approval is required before proceeding."
        },
        {
          title: "Collect seller Emirates ID and Mulkiya",
          meta: "CSR or Purchaser at check in.",
          note: "These documents confirm the individual seller and ownership."
        },
        {
          title: "Sign VSA and set beneficiary",
          meta: "Purchaser after deal finalisation.",
          note: "If beneficiary is not the seller, collect Emirates ID or trade license for that account."
        },
        {
          title: "Collect full payment from dealer",
          meta: "DRE collects and Finance verifies.",
          note: "No transfer booking until payment is confirmed in full."
        },
        {
          title: "Complete transfer and capture buyer Mulkiya or Hayaza",
          meta: "Transfer Agent at RTA.",
          note: "New buyer Mulkiya or possession certificate is shared with BO Team."
        },
        {
          title: "Update CRM with prices, VAT, and fees",
          meta: "BO Team, DRE, Transfer Agent, Auction TL.",
          note: "Seller name, purchase price, selling price, dealer admin and transfer fees, RTA fees, fines, passing cost, seller deductions, and highest bid must be correct."
        },
        {
          title: "Request seller payment",
          meta: "Purchaser after CRM check.",
          note: "Only after all CRM fields and approval email details are confirmed."
        }
      ],
      footer:
        "Purchaser checks each CRM field and the auction approval email before asking Finance to release the payment to the seller."
    },
    {
      id: "auction-fleet",
      dealType: "auction",
      label: "Auction . Company fleet seller",
      shortMeta: "Fleet sale with proforma invoice.",
      tagline: "Auction deal",
      title: "Seller company fleet . buyer dealer or company",
      subtitle: "Company fleet sale through auction, with proforma invoice and VAT handling.",
      people: [
        "CSR and Purchaser at check in",
        "Aatif or assigned approver for auction approval",
        "DRE and Finance for payment",
        "Transfer Agent at RTA"
      ],
      timing: [
        "Before deal closure . Trade license and proforma invoice collected.",
        "Before transfer . Dealer payment verified.",
        "After transfer . CRM VAT status and prices updated."
      ],
      paymentCondition:
        "Company trade license and signed proforma invoice are on file, auction approval email is available, dealer payment is verified, and CRM has correct VAT status and prices.",
      steps: [
        {
          title: "Collect company Mulkiya",
          meta: "CSR or Purchaser at check in.",
          note: "Confirms that the vehicle belongs to the fleet company."
        },
        {
          title: "Collect company trade license",
          meta: "Purchaser before deal closure.",
          note: "Used for VAT status and beneficiary details."
        },
        {
          title: "Collect signed and stamped proforma invoice",
          meta: "Purchaser before deal closure.",
          note: "Invoice must show agreed price and company details."
        },
        {
          title: "Get auction email approval",
          meta: "Purchaser starts email chain, approver confirms.",
          note: "Aatif or designated approver must sign off the deal."
        },
        {
          title: "Collect full payment from dealer",
          meta: "DRE collects, Finance verifies.",
          note: "Payment must clear before any transfer is booked."
        },
        {
          title: "Update CRM and confirm VAT status",
          meta: "Purchaser and BO Team.",
          note: "Set VAT status to B2B or PMS as applicable and confirm purchase price and other values before payment request."
        }
      ],
      footer:
        "Purchaser ensures trade license, proforma invoice, approval email, payment, and CRM VAT status are all correct before requesting seller payment."
    }
  ];

  const scenarioListEl = document.getElementById("scenarioList");
  const dealFilterEl = document.getElementById("dealFilter");
  const taglineEl = document.getElementById("scenarioTagline");
  const titleEl = document.getElementById("scenarioTitle");
  const subtitleEl = document.getElementById("scenarioSubtitle");
  const peopleBoxEl = document.getElementById("peopleBox");
  const timingBoxEl = document.getElementById("timingBox");
  const paymentBoxEl = document.getElementById("paymentBox");
  const stepsContainerEl = document.getElementById("stepsContainer");
  const footerNoteEl = document.getElementById("footerNote");
  const prevStepBtn = document.getElementById("prevStepBtn");
  const nextStepBtn = document.getElementById("nextStepBtn");

  let activeFlowId = null;
  let activeStepIndex = 0;

  function renderScenarioButtons() {
    scenarioListEl.innerHTML = "";
    const selectedDeal = dealFilterEl.value;

    flows.forEach(flow => {
      if (selectedDeal !== "all" && flow.dealType !== selectedDeal) {
        return;
      }
      const li = document.createElement("li");
      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "scenario-button";
      btn.setAttribute("data-id", flow.id);
      btn.setAttribute("aria-pressed", flow.id === activeFlowId ? "true" : "false");
      btn.innerHTML = `
        <span class="scenario-name">${flow.label}</span>
        <span class="scenario-meta">${flow.shortMeta}</span>
      `;
      btn.addEventListener("click", () => {
        setActiveFlow(flow.id);
      });
      li.appendChild(btn);
      scenarioListEl.appendChild(li);
    });

    // If nothing selected yet, default to first visible
    if (!activeFlowId) {
      const firstBtn = scenarioListEl.querySelector(".scenario-button");
      if (firstBtn) {
        const id = firstBtn.getAttribute("data-id");
        setActiveFlow(id);
      }
    } else {
      // Keep pressed state consistent
      scenarioListEl
        .querySelectorAll(".scenario-button")
        .forEach(btn => {
          const id = btn.getAttribute("data-id");
          btn.setAttribute("aria-pressed", id === activeFlowId ? "true" : "false");
        });
    }
  }

  function setActiveFlow(id) {
    const flow = flows.find(f => f.id === id);
    if (!flow) return;

    activeFlowId = id;
    activeStepIndex = 0;

    // Update pressed state on buttons
    scenarioListEl
      .querySelectorAll(".scenario-button")
      .forEach(btn => {
        const btnId = btn.getAttribute("data-id");
        btn.setAttribute("aria-pressed", btnId === activeFlowId ? "true" : "false");
      });

    // Update header
    taglineEl.textContent = flow.tagline;
    titleEl.textContent = flow.title;
    subtitleEl.textContent = flow.subtitle;

    // Update key info
    peopleBoxEl.innerHTML = flow.people
      .map(p => `<span class="pill-inline">${p}</span>`)
      .join(" ");
    timingBoxEl.innerHTML = flow.timing
      .map(t => `<div>${t}</div>`)
      .join("");
    paymentBoxEl.textContent = flow.paymentCondition;

    // Update steps
    renderSteps();

    // Footer
    footerNoteEl.textContent = flow.footer;
  }

  function renderSteps() {
    const flow = flows.find(f => f.id === activeFlowId);
    if (!flow) {
      stepsContainerEl.innerHTML = `
        <div class="step">
          <div class="step-title">No steps to display</div>
          <div class="step-meta">Choose a scenario to see its checklist.</div>
        </div>
      `;
      return;
    }

    stepsContainerEl.innerHTML = "";
    flow.steps.forEach((step, index) => {
      const stepEl = document.createElement("div");
      stepEl.className = "step" + (index === activeStepIndex ? " active" : "");
      stepEl.setAttribute("data-index", index);
      stepEl.innerHTML = `
        <div class="step-title">${index + 1}. ${step.title}</div>
        <div class="step-meta">${step.meta}</div>
        <div class="step-note">${step.note}</div>
      `;
      stepEl.addEventListener("click", () => {
        activeStepIndex = index;
        renderSteps();
      });
      stepsContainerEl.appendChild(stepEl);
    });
  }

  function moveStep(direction) {
    const flow = flows.find(f => f.id === activeFlowId);
    if (!flow) return;
    const maxIndex = flow.steps.length - 1;
    if (direction === "next") {
      activeStepIndex = Math.min(maxIndex, activeStepIndex + 1);
    } else {
      activeStepIndex = Math.max(0, activeStepIndex - 1);
    }
    renderSteps();
    const activeEl = stepsContainerEl.querySelector(".step.active");
    if (activeEl) {
      activeEl.scrollIntoView({ block: "nearest", behavior: "smooth" });
    }
  }

  dealFilterEl.addEventListener("change", () => {
    activeFlowId = null;
    renderScenarioButtons();
  });

  prevStepBtn.addEventListener("click", () => moveStep("prev"));
  nextStepBtn.addEventListener("click", () => moveStep("next"));

  // Initial render
  renderScenarioButtons();
</script>
</body>
</html>
